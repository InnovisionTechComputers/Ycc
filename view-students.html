<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <title>рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╛рджреА - рдпрд╢реЛрджреАрдк рдХреНрд▓рд╛рд╕реЗрд╕</title>
    <style>
        body { display: flex; font-family: 'Segoe UI', sans-serif; margin: 0; background: #f0f2f5; }
        .sidebar { width: 250px; background: #2c3e50; color: white; height: 100vh; padding: 20px; position: fixed; }
        .sidebar h2 { color: #3498db; text-align: center; }
        .sidebar a { display: block; color: white; padding: 15px; text-decoration: none; border-bottom: 1px solid #3e4f5f; }
        
        .main { margin-left: 280px; padding: 30px; width: calc(100% - 310px); }
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: relative; }
        
        /* Language Switcher */
        .lang-container { position: absolute; top: 20px; right: 25px; }
        .lang-btn { background: #3498db; color: white; border: none; padding: 5px 15px; border-radius: 4px; cursor: pointer; }

        .filter-section { margin-bottom: 20px; padding: 15px; background: #e8f4fd; border-radius: 8px; display: flex; align-items: center; gap: 15px; }
        select { padding: 8px; border-radius: 5px; border: 1px solid #3498db; font-size: 16px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #3498db; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        #loader { font-weight: bold; color: #e67e22; display: none; margin-left: 10px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2 id="sideTitle">рдпрд╢реЛрджреАрдк рдХреНрд▓рд╛рд╕реЗрд╕</h2>
        <a href="dashboard.html"  id="navNewAdm">ЁЯУЭ рдирд╡реАрди рдНрдбрдорд┐рд╢рди</a>
        <a href="view-students.html" style="background:#3498db" id="navStudentList">ЁЯУЛ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╛рджреА</a>
        <a href="attendance.html" id="navAttendance">ЁЯУЕ рд╣рдЬреЗрд░реА</a>
        <a href="results.html"  id="navResults">ЁЯУК рдорд╛рд░реНрдХ рдЕрдкрдбреЗрдЯ</a>
        <a href="fees.html" id="navFees">ЁЯТ░ рдлреА рд░реЗрдХреЙрд░реНрдб</a>
        <a href="expenses.html" id="navExpenses">ЁЯТ╕ рдЦрд░реНрдЪ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди</a>
        <a href="#" onclick="logout()" id="navLogout">ЁЯЪк Log Out</a>
    </div>

    <div class="main">
        <div class="card">
            <div class="lang-container">
                <button class="lang-btn" id="langBtn" onclick="toggleLang()">English</button>
            </div>

            <h2 id="pageTitle">рдиреЛрдВрджрдгреАрдХреГрдд рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╛рджреА</h2>
            
            <div class="filter-section">
                <label><strong id="lblSelectClass">рд╡рд░реНрдЧрд╛рдиреБрд╕рд╛рд░ рдпрд╛рджреА рдкрд╣рд╛:</strong></label>
                <select id="classSelect" onchange="loadClassData()">
                    <option value="" id="optDefault">-- рд╡рд░реНрдЧ рдирд┐рд╡рдбрд╛ --</option>
                    <option value="5">рел рд╡реА</option><option value="6">рем рд╡реА</option>
                    <option value="7">рен рд╡реА</option><option value="8">рео рд╡реА</option>
                    <option value="9">реп рд╡реА</option><option value="10">резреж рд╡реА</option>
                    <option value="11">резрез рд╡реА</option><option value="12">резреи рд╡реА</option>
                </select>
                <span id="loader">рдорд╛рд╣рд┐рддреА рд▓реЛрдб рд╣реЛрдд рдЖрд╣реЗ...</span>
            </div>

            <table id="studentTable">
                <thead>
                    <tr>
                        <th>PRN</th>
                        <th id="thName">рдирд╛рд╡</th>
                        <th id="thPhone">рдлреЛрди рдирдВрдмрд░</th>
                        <th id="thDOB">рдЬрдиреНрдорддрд╛рд░реАрдЦ</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="4" style="text-align:center;" id="initialMsg">рдХреГрдкрдпрд╛ рд╡рд░реНрдЧ рдирд┐рд╡рдбрд╛...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let currentLang = sessionStorage.getItem("lang") || 'mr';

        const langData = {
            mr: {
                sideTitle: "рдпрд╢реЛрджреАрдк рдХреНрд▓рд╛рд╕реЗрд╕", navNewAdm: "ЁЯУЭ рдирд╡реАрди рдНрдбрдорд┐рд╢рди", navStudentList: "ЁЯУЛ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╛рджреА", navAttendance: "ЁЯУЕ рд╣рдЬреЗрд░реА", navResults: "ЁЯУК рдирд┐рдХрд╛рд▓/рдорд╛рд░реНрдХ", navFees: "ЁЯТ░ рдлреА рд░реЗрдХреЙрд░реНрдб", navExpenses: "ЁЯТ╕ рдЦрд░реНрдЪ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди", navLogout: "ЁЯЪк Log Out",
                pageTitle: "рдиреЛрдВрджрдгреАрдХреГрдд рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╛рджреА", lblSelectClass: "рд╡рд░реНрдЧрд╛рдиреБрд╕рд╛рд░ рдпрд╛рджреА рдкрд╣рд╛:", optDefault: "-- рд╡рд░реНрдЧ рдирд┐рд╡рдбрд╛ --",
                thName: "рдирд╛рд╡", thPhone: "рдлреЛрди рдирдВрдмрд░", thDOB: "рдЬрдиреНрдорддрд╛рд░реАрдЦ", initialMsg: "рдХреГрдкрдпрд╛ рд╡рд░реНрдЧ рдирд┐рд╡рдбрд╛...",
                loader: "рдорд╛рд╣рд┐рддреА рд▓реЛрдб рд╣реЛрдд рдЖрд╣реЗ...", noData: "рдпрд╛ рд╡рд░реНрдЧрд╛рдд рдЕрджреНрдпрд╛рдк рдХреЛрдгреАрд╣реА рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдирд╛рд╣реА.", alertError: "рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рддрд╛рдирд╛ рддреНрд░реБрдЯреА рдЖрд▓реА!", langBtn: "English"
            },
            en: {
                sideTitle: "Yashodeep Classes", navNewAdm: "ЁЯУЭ New Admission", navStudentList: "ЁЯУЛ Student List", navAttendance: "ЁЯУЕ Attendance", navResults: "ЁЯУК Marks/Results", navFees: "ЁЯТ░ Fee Records", navExpenses: "ЁЯТ╕ Expenses", navLogout: "ЁЯЪк Log Out",
                pageTitle: "Registered Student List", lblSelectClass: "View List by Class:", optDefault: "-- Select Class --",
                thName: "Name", thPhone: "Phone Number", thDOB: "Date of Birth", initialMsg: "Please select a class...",
                loader: "Loading data...", noData: "No students found in this class.", alertError: "Error loading data!", langBtn: "рдорд░рд╛рдареА"
            }
        };

        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzL-qXRUzRf6_kd5UO404p0DaTnYytq-RkxQ2tQCvhac0yziN2yfbx_H9wr-8X6irFrQQ/exec";

        document.addEventListener("DOMContentLoaded", function() {
            const role = sessionStorage.getItem("userRole");
            if (sessionStorage.getItem("isLoggedIn") !== "true") { window.location.href = "index.html"; return; }
            
            // MD рд╕рд╛рдареА рдлреА рдЖрдгрд┐ рдЦрд░реНрдЪ рд▓рдкрд╡рдгреЗ
            if (role === "md") {
                const feeLink = document.getElementById("navFees");
                const expLink = document.getElementById("navExpenses");
                if (feeLink) feeLink.style.display = "none";
                if (expLink) expLink.style.display = "none";
            }
            updateLanguageUI();
        });

        function toggleLang() {
            currentLang = (currentLang === 'mr') ? 'en' : 'mr';
            sessionStorage.setItem("lang", currentLang);
            updateLanguageUI();
            loadClassData(); // рднрд╛рд╖рд╛ рдмрджрд▓рд▓реНрдпрд╛рд╡рд░ рдбреЗрдЯрд╛ рдкреБрдиреНрд╣рд╛ рджрд╛рдЦрд╡рдгреНрдпрд╛рд╕рд╛рдареА
        }

        function updateLanguageUI() {
            const t = langData[currentLang];
            for (let id in t) {
                const el = document.getElementById(id);
                if (el) el.innerText = t[id];
            }
        }

        async function loadClassData() {
            const selectedClass = document.getElementById('classSelect').value;
            const tableBody = document.getElementById('tableBody');
            const loader = document.getElementById('loader');
            const t = langData[currentLang];

            if (!selectedClass) {
                tableBody.innerHTML = `<tr><td colspan="4" style="text-align:center;">${t.initialMsg}</td></tr>`;
                return;
            }

            loader.style.display = "inline";
            loader.innerText = t.loader;
            tableBody.innerHTML = "";

            try {
                const response = await fetch(`${SCRIPT_URL}?action=read&className=Class ${selectedClass}`);
                const data = await response.json();

                if (data.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="4" style="text-align:center;">${t.noData}</td></tr>`;
                } else {
                    data.forEach(student => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${student.prn}</td>
                            <td>${student.name}</td>
                            <td>${student.parentPhone}</td>
                            <td>${student.dob}</td>
                        `;
                        tableBody.appendChild(tr);
                    });
                }
            } catch (error) {
                alert(t.alertError);
            } finally {
                loader.style.display = "none";
            }
        }

        function logout() {
            sessionStorage.clear();
            window.location.href = "index.html";
        }
    </script>
</body>
</html>